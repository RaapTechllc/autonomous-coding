<project_specification>
  <project_name>SMW Commission Agent - Commission Dashboard</project_name>

  <overview>
    Build a commission tracking dashboard for SMW (Sheet Metal Works) that turns CRM revenue data and fabrication project
    data into clear, auditable commission payouts. The app syncs deals from Salesforce (and/or CSV/Excel import), tracks
    fabrication projects with jobs, calculates commissions from plan rules (both deal-based and project-based), generates
    period statements, and supports review + approvals before payout. It includes an Executive/CFO dashboard for project
    tracking, PO management, margin analysis, and AR verification. An "AI Commission Agent" (post-MVP) can explain any
    payout line item using the underlying data and rules (no guessing).

    MVP focuses on: CSV/Excel ingest, project tracking system, rules-based calculator (deal + project commissions),
    statements, rep-facing dashboard, and executive dashboard. Commission profiles allow standardized plan assignment.
    Post-MVP adds: AI agent, richer rule engine, workflows, disputes, forecasting, and payroll integrations.
  </overview>

  <technology_stack>
    <frontend>
      <framework>React 18+ with Vite 5+</framework>
      <styling>Tailwind CSS (via CDN)</styling>
      <state_management>React hooks and context</state_management>
      <routing>React Router</routing>
      <charts>Recharts</charts>
      <tables>TanStack Table</tables>
      <port>Only launch on port 5173</port>
    </frontend>

    <backend>
      <runtime>Node.js with Express</runtime>
      <database>SQLite with better-sqlite3 (MVP), Postgres-ready schema (post-MVP)</database>
      <auth>Session or JWT auth with RBAC</auth>
      <jobs>node-cron (MVP), queue-backed jobs (post-MVP)</jobs>
      <integrations>Salesforce REST sync + CSV/Excel import</integrations>
      <streaming>SSE for sync progress + long-running calc progress</streaming>
    </backend>

    <communication>
      <api>RESTful endpoints</api>
      <streaming>SSE</streaming>
    </communication>

    <ai_commission_agent>
      <mode>Optional in MVP; full post-MVP</mode>
      <approach>Tool-based responses grounded in stored commission data and plan rules</approach>
      <guardrails>No external facts. No payout changes without explicit user action.</guardrails>
    </ai_commission_agent>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      - Follow the Harness repo conventions. Do not change the harness behavior.
      - Frontend uses the existing Vite + pnpm setup in the repo.
      - Backend code lives in /server.
      - Use .env for secrets:
        - SALESFORCE_CLIENT_ID, SALESFORCE_CLIENT_SECRET (if used)
        - SALESFORCE_LOGIN_URL (prod/sandbox)
        - SALESFORCE_REDIRECT_URI
        - APP_SECRET (sessions/JWT signing)
      - Start services using the repo’s standard scripts.
    </environment_setup>
  </prerequisites>

  <core_features>
    <mvp_scope>
      <data_ingest>
        - Connect to Salesforce and pull Opportunities + key fields (amount, stage, close date, owner, account, products if available)
        - Manual CSV import (same canonical schema)
        - Excel (.xlsx) import for projects, jobs, and actuals
        - Field mapping UI (simple mapping wizard)
        - Sync run log with status, counts, and errors
        - Support for importing: opportunities, projects, project jobs, actual hours, financials
      </data_ingest>

      <commission_plans>
        - Create a plan with versions (effective_start, effective_end)
        - Basic rule types:
          - Flat percent of commissionable amount
          - Tiered percent by amount thresholds
          - Profit percent (for profit-based commissions, excludes freight)
          - Tiered profit percent
          - Milestone percent (for project milestone-based commissions)
          - Split support (percent splits across reps)
        - Plan assignment by rep (user)
        - Commission profiles: Standardized plan templates (e.g., "Fabrication Seller 1.0% Revenue", "Fabrication Profit Owner 5% Profit")
        - Default profile assignment: Users can have default seller and profit owner profiles assigned during creation
      </commission_plans>

      <commission_calculation>
        - Deterministic calculator that produces:
          - Per-deal commission line items (opportunity-based)
          - Per-project commission line items (project-based: seller milestones, profit owner at job close)
          - Per-period statement totals
        - Supports both opportunity-level and project-level commissions
        - Project commissions: Seller gets % of project sell price at milestones; Profit owner gets % of true profit (excluding freight) at project close
        - Recalculate on demand (idempotent; snapshots saved)
        - Audit trail for every calculation run
      </commission_calculation>

      <statements>
        - Generate statements for a pay period (monthly default)
        - Statement line items per opportunity (and adjustments)
        - Export CSV (MVP) and print-friendly view
      </statements>

      <rep_dashboard>
        - YTD commissions, current period estimate, last payout
        - Deal list with "commission status" (pending, eligible, calculated)
        - Filters by period, stage, rep
      </rep_dashboard>

      <project_tracking>
        - Fabrication project tracker with project numbers
        - Project-level fields: PO number, PO total, quote details, PM contact, site address
        - Job tracking: 5-digit job numbers, quoted vs actual hours/pounds, sell prices
        - PO tracking: Total contract, billed contract, billed extra, PO remaining calculations
        - Quote tracking: Quote number, quote price, quoted pounds/hours, material/labor costs, markup %, expected profit %
        - Margin analysis: Hours margin (quoted vs actual), contract margin, extra margin
        - Invoice tracking: Invoice numbers, invoice totals, pre-tax prices, AR verification status
        - Job status: Section categorization (EXTRA, HOLD, standard), job dates, fab dates
        - Financial tracking: Actual revenue, costs (materials, labor, subs, freight, other), actual profit
        - Project participants: Assign sellers (revenue credit) and profit owners (profit credit) with credit percentages
        - Project milestones: Track milestone achievements with payout percentages for seller commissions
      </project_tracking>

      <executive_dashboard>
        - CFO/Management dashboard with aggregated project metrics
        - KPI cards: Total projects, active projects, total revenue, total profit, average margin
        - Project status breakdown (active, closed, cancelled)
        - Top projects by revenue
        - PO tracking summary across all projects
        - Margin trends and analysis
        - Outstanding invoices (AR not verified)
        - Projects with negative PO remaining (over-billed)
        - Projects on hold status
        - Charts: Status distribution, top projects by revenue
      </executive_dashboard>

      <admin_basics>
        - User management (rep/manager/finance/admin roles)
        - Global settings: currency, pay period cadence, rounding rules
        - Default commission profile assignment during user creation (seller profile, profit owner profile)
      </admin_basics>
    </mvp_scope>

    <post_mvp_scope>
      <workflows>
        - Rep review + acknowledgement
        - Manager approval
        - Finance finalize
        - Payout marking (paid date, method, reference)
      </workflows>

      <disputes_adjustments>
        - Dispute a line item with comments and attachments
        - Adjustment types: spiff/bonus, clawback, true-up, manual override
        - Approval required for overrides
      </disputes_adjustments>

      <advanced_plans>
        - More rule dimensions:
          - Product/category rates
          - Region/segment multipliers
          - Stage gating (pay only at Closed Won)
          - Quota + accelerators
          - Draws and recoverable draws
          - Caps and floors
        - Rule testing sandbox (simulate a deal)
      </advanced_plans>

      <forecasting_analytics>
        - Pipeline-to-commission forecast
        - Quota attainment tracking
        - Leaderboards (optional)
        - “What-if” plan comparison
      </forecasting_analytics>

      <integrations>
        - Scheduled sync (nightly) + on-demand sync
        - Payroll export formats (configurable)
        - Webhook support (if available)
      </integrations>

      <ai_commission_agent>
        - Ask questions like:
          - “Why is this deal paying $X?”
          - “What plan rules were applied?”
          - “What deals are missing data?”
          - “What do I need to close to hit $Y this month?”
        - Agent produces answers with:
          - linked opportunities
          - linked plan version + rules
          - calculation snapshot references
        - Agent can draft dispute tickets and adjustment requests (but cannot apply them without user confirmation)
      </ai_commission_agent>

      <security_compliance>
        - RBAC (rep/manager/finance/admin)
        - Encrypted token storage for integrations
        - Full audit log export
      </security_compliance>
    </post_mvp_scope>
  </core_features>

  <database_schema>
    <tables>
      <users>
        - id, email, name
        - role (rep/manager/finance/admin)
        - is_active
        - created_at, updated_at
      </users>

      <settings>
        - id
        - currency, rounding_mode, pay_period_type
        - created_at, updated_at
      </settings>

      <integrations_salesforce>
        - id
        - auth_type (oauth/jwt/manual)
        - instance_url
        - access_token_encrypted, refresh_token_encrypted (if applicable)
        - last_sync_at
        - created_at, updated_at
      </integrations_salesforce>

      <sync_runs>
        - id, source (salesforce/csv)
        - started_at, finished_at, status
        - records_in, records_upserted, records_failed
        - error_summary
      </sync_runs>

      <opportunities>
        - id
        - external_id (salesforce_id or csv_key)
        - name, account_name
        - owner_user_id
        - stage, close_date
        - amount, commissionable_amount
        - currency
        - raw_payload (JSON)
        - created_at, updated_at
      </opportunities>

      <opportunity_splits>
        - id, opportunity_id
        - user_id
        - split_percent
      </opportunity_splits>

      <commission_plans>
        - id, name, description
        - created_at, updated_at
      </commission_plans>

      <commission_plan_versions>
        - id, plan_id
        - version_name
        - effective_start, effective_end
        - status (draft/active/retired)
        - created_at, updated_at
      </commission_plan_versions>

      <commission_rules>
        - id, plan_version_id
        - rule_type (flat_percent/tiered_percent/profit_percent/tiered_profit_percent/milestone_percent)
        - config (JSON)
        - priority
      </commission_rules>

      <plan_assignments>
        - id
        - user_id
        - plan_version_id
        - effective_start, effective_end
      </plan_assignments>

      <calculation_runs>
        - id
        - period_start, period_end
        - triggered_by_user_id
        - status
        - created_at, finished_at
      </calculation_runs>

      <commission_line_items>
        - id
        - calculation_run_id
        - opportunity_id (nullable, for deal-based commissions)
        - project_id (nullable, for project-based commissions)
        - user_id
        - plan_version_id
        - rule_applied_summary
        - commission_amount
        - details (JSON snapshot of inputs + applied tiers)
        - created_at
        - CHECK constraint: either opportunity_id OR project_id must be present (not both)
      </commission_line_items>

      <statements>
        - id
        - user_id
        - period_start, period_end
        - total_commission
        - status (draft/final)
        - created_at, updated_at
      </statements>

      <statement_items>
        - id
        - statement_id
        - line_item_id (nullable)
        - kind (opportunity/adjustment)
        - description
        - amount
      </statement_items>

      <adjustments>
        - id
        - user_id
        - period_start, period_end
        - type (bonus/clawback/trueup/override)
        - amount
        - reason
        - status (pending/approved/rejected/applied)
        - created_at, updated_at
      </adjustments>

      <audit_events>
        - id
        - actor_user_id
        - entity_type, entity_id
        - action
        - before (JSON), after (JSON)
        - created_at
      </audit_events>

      <disputes>
        - id
        - user_id
        - statement_item_id
        - status (open/triaged/resolved/denied)
        - reason
        - created_at, updated_at
      </disputes>

      <projects>
        - id, project_number (unique), customer, status (active/closed/cancelled)
        - award_date, project_sell_price_total
        - po_number, po_total
        - quote_number, quote_price, quote_pounds, quote_material_cost, quote_labor_cost
        - quote_markup_percent, expected_profit_percent, expected_profit
        - labor_rate, pm_contact, updated_thru
        - created_at, updated_at
      </projects>

      <project_jobs>
        - id, project_id (FK), job_number (5-digit), section (EXTRA/HOLD/blank)
        - job_date, fab_date, po_number, job_status
        - sell_price, pre_tax_price, quoted_pounds, pounds (actual)
        - quoted_hours, actual_hours
        - material_cost, labor_cost, machine_rate
        - invoice_number, invoice_total, ar_verified (YES/blank)
        - created_at, updated_at
        - UNIQUE(project_id, job_number)
      </project_jobs>

      <project_financials>
        - id, project_id (unique FK)
        - actual_revenue, cost_materials, cost_labor, cost_subs, cost_freight, cost_other
        - shop_rate_per_hour, material_cost_per_lb
        - project_close_date
        - created_at, updated_at
      </project_financials>

      <project_participants>
        - id, project_id (FK), user_id (FK)
        - component (revenue/profit), role (seller/profit_owner)
        - credit_percent (0-100)
        - created_at, updated_at
      </project_participants>

      <project_milestones>
        - id, project_id (FK), milestone_type, date_achieved
        - payout_percent (0-100)
        - created_at, updated_at
      </project_milestones>

      <opportunity_participants>
        - id, opportunity_id (FK), user_id (FK)
        - component (revenue/profit), role (seller/profit_owner)
        - credit_percent (0-100)
        - created_at, updated_at
      </opportunity_participants>
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <auth>
      - POST /api/auth/login
      - POST /api/auth/logout
      - GET /api/auth/me
    </auth>

    <users>
      - GET /api/users
      - POST /api/users
      - PUT /api/users/:id
      - PUT /api/users/:id/disable
    </users>

    <settings>
      - GET /api/settings
      - PUT /api/settings
    </settings>

    <integrations>
      - POST /api/integrations/salesforce/connect
      - POST /api/integrations/salesforce/disconnect
      - GET /api/integrations/salesforce/status
    </integrations>

    <sync>
      - POST /api/sync/salesforce/run
      - POST /api/sync/csv/import
      - POST /api/sync/xlsx/import (Excel import)
      - GET /api/sync/runs
      - GET /api/sync/runs/:id
      - GET /api/sync/stream (SSE)
    </sync>

    <opportunities>
      - GET /api/opportunities
      - GET /api/opportunities/:id
      - PUT /api/opportunities/:id (admin override fields like commissionable_amount)
    </opportunities>

    <plans>
      - GET /api/plans
      - POST /api/plans
      - GET /api/plans/:id
      - POST /api/plans/:id/versions
      - PUT /api/plan-versions/:id
      - POST /api/plan-versions/:id/activate
      - POST /api/plan-versions/:id/test
    </plans>

    <calculations>
      - POST /api/calculations/run
      - GET /api/calculations/runs
      - GET /api/calculations/runs/:id
      - GET /api/calculations/stream (SSE)
    </calculations>

    <statements>
      - GET /api/statements?period=YYYY-MM
      - POST /api/statements/generate
      - GET /api/statements/:id
      - GET /api/statements/:id/export/csv
      - PUT /api/statements/:id/finalize
    </statements>

    <adjustments>
      - GET /api/adjustments
      - POST /api/adjustments
      - PUT /api/adjustments/:id/approve
      - PUT /api/adjustments/:id/reject
    </adjustments>

    <disputes>
      - GET /api/disputes
      - POST /api/disputes
      - PUT /api/disputes/:id/status
      - POST /api/disputes/:id/comment
    </disputes>

    <audit>
      - GET /api/audit?entity_type=&entity_id=
    </audit>

    <projects>
      - GET /api/projects (list with filters: search, status, pagination)
      - GET /api/projects/:id (detail with jobs, participants, milestones, financials)
      - POST /api/projects
      - PUT /api/projects/:id
      - DELETE /api/projects/:id
      - GET /api/projects/:id/jobs
      - POST /api/projects/:id/jobs
      - PUT /api/projects/:id/jobs/:jobId
      - DELETE /api/projects/:id/jobs/:jobId
      - GET /api/projects/:id/participants
      - POST /api/projects/:id/participants
      - DELETE /api/projects/:id/participants/:participantId
      - GET /api/projects/:id/milestones
      - POST /api/projects/:id/milestones
      - PUT /api/projects/:id/milestones/:milestoneId
      - DELETE /api/projects/:id/milestones/:milestoneId
      - GET /api/projects/:id/financials
      - PUT /api/projects/:id/financials
    </projects>

    <dashboard>
      - GET /api/dashboard (rep dashboard stats)
      - GET /api/dashboard/projects (executive dashboard stats)
    </dashboard>

    <ai_agent>
      - POST /api/agent/ask
      - POST /api/agent/draft-dispute
      - POST /api/agent/draft-adjustment
    </ai_agent>
  </api_endpoints_summary>

  <ui_layout>
    <main_structure>
      - Two-column layout (MVP): left nav + main content
      - Optional right drawer (post-MVP): inspector / AI agent / details
      - Responsive: mobile collapses nav into hamburger
    </main_structure>

    <sidebar_left>
      - Dashboard (rep view)
      - Executive (admin/finance/manager - CFO dashboard)
      - Deals
      - Projects (fabrication project tracker)
      - Statements
      - Plans (admin)
      - Sync (admin)
      - Users (admin)
      - Settings
    </sidebar_left>

    <main_views>
      <dashboard>
        - KPI cards (YTD, current period, last payout)
        - Trends chart (by month)
        - “Needs attention” list (missing data, sync errors)
      </dashboard>

      <deals>
        - Table with filters and row detail drawer
        - Columns: name, stage, amount, commissionable_amount, owner, status, estimated_commission
      </deals>

      <statements>
        - Period picker
        - Statement summary + line items
        - Export actions
      </statements>

      <plans>
        - Plan list
        - Version editor (rules builder)
        - Test sandbox
      </plans>

      <sync>
        - Connect status
        - Run sync button
        - CSV and Excel import options
        - Sync run log + progress
      </sync>

      <projects>
        - Project list with filters (search, status, pagination)
        - Project detail page with tabs:
          - Overview: Project info, financial summary, PO tracking, quote details
          - Jobs: Table of all jobs with quoted vs actual hours/pounds, margins, invoices, AR status
          - Participants: Sellers and profit owners with credit percentages
          - Milestones: Milestone tracking with payout percentages
        - Add/Edit project modal
        - Add/Edit job modal
        - Financials editor
      </projects>

      <executive_dashboard>
        - KPI cards: Total projects, active projects, total revenue, total profit, average margin
        - Status breakdown chart (pie chart)
        - Top projects by revenue (bar chart)
        - Alerts: Over-billed projects, projects on hold, outstanding invoices
        - Quick links to project details
      </executive_dashboard>
    </main_views>
  </ui_layout>

  <design_system>
    <color_palette>
      - Primary: Deep blue or teal accent (trust/finance feel)
      - Background: Light and dark mode
      - Status colors: pending/eligible/calculated/finalized
    </color_palette>

    <typography>
      - Inter/system font
      - Clear hierarchy for money numbers (large, bold)
      - Monospace for IDs and rule debugging
    </typography>

    <components>
      - KPI cards
      - Data tables with sticky header
      - Period picker
      - Drawer panel for details
      - Timeline/audit list
      - Empty states with next-step CTA
    </components>

    <animations>
      - Subtle transitions
      - Progress indicators for sync and calculations
    </animations>
  </design_system>

  <key_interactions>
    <sync_flow>
      1. Admin connects Salesforce (or uploads CSV)
      2. User runs sync
      3. SSE shows progress and errors
      4. Opportunities list updates
    </sync_flow>

    <calc_flow>
      1. Admin selects period and runs calculation
      2. Calculator applies plan versions and splits
      3. Line items are saved as immutable snapshots
      4. Statements can be generated from snapshots
    </calc_flow>

    <statement_flow>
      1. Rep opens the period statement
      2. Rep drills into a line item to see rule explanation
      3. Rep exports CSV or prints
      4. Post-MVP: rep disputes a line item
    </statement_flow>

    <agent_flow>
      1. User asks “Why is this $X?”
      2. Agent fetches the line item snapshot + plan version + rules
      3. Agent returns a grounded explanation and links to records
      4. Agent can draft a dispute or adjustment request
    </agent_flow>
  </key_interactions>

  <implementation_steps>
    <step number="1">
      <title>Foundation and Data Model</title>
      <tasks>
        - Set up /server Express app with SQLite and migrations
        - Implement RBAC auth (rep/admin minimum)
        - Create core tables: users, opportunities, plans, calculations, statements, audit_events
        - Add seed data and fixtures for local dev
      </tasks>
    </step>

    <step number="2">
      <title>Frontend Shell and Navigation</title>
      <tasks>
        - Build app layout with sidebar and routing
        - Implement Dashboard, Deals, Statements pages (empty state first)
        - Add reusable table, KPI cards, and period picker components
      </tasks>
    </step>

    <step number="3">
      <title>Ingest: CSV and Excel, Salesforce Next</title>
      <tasks>
        - Build CSV import endpoint + mapping UI
        - Build Excel (.xlsx) import endpoint for projects, jobs, and actuals
        - Normalize into opportunities table
        - Support importing projects, project jobs, actual hours, financials
        - Add sync_runs log and error reporting
        - Add Salesforce connect + pull as post-MVP toggle if needed
      </tasks>
    </step>

    <step number="4">
      <title>Commission Plan Builder (MVP Rules)</title>
      <tasks>
        - Plan + version CRUD
        - Flat percent + tiered percent rules in config JSON
        - Assign active plan version to reps
        - Plan test endpoint: input deal => expected commission
      </tasks>
    </step>

    <step number="5">
      <title>Commission Calculator and Snapshots</title>
      <tasks>
        - Build deterministic calculation engine
        - Support splits and rounding rules
        - Persist commission_line_items with details snapshot
        - Expose calculation runs and logs
      </tasks>
    </step>

    <step number="6">
      <title>Statements and Exports</title>
      <tasks>
        - Generate statements from snapshots per period
        - Build statement UI and CSV export
        - Add basic print-friendly layout
      </tasks>
    </step>

    <step number="6.5">
      <title>Project Tracking System</title>
      <tasks>
        - Create projects, project_jobs, project_financials, project_participants, project_milestones tables
        - Build project CRUD API endpoints
        - Build project detail page with tabs (Overview, Jobs, Participants, Milestones, Financials)
        - Add PO tracking calculations (total contract, billed contract, billed extra, PO remaining)
        - Add quote details tracking
        - Add margin calculations (hours margin, contract margin, extra margin)
        - Add invoice tracking with AR verification
        - Integrate project-level commissions into calculation engine
        - Add Excel import for projects and jobs
      </tasks>
    </step>

    <step number="6.6">
      <title>Executive Dashboard and Commission Profiles</title>
      <tasks>
        - Build executive/CFO dashboard with aggregated project metrics
        - Add KPI cards and charts (status breakdown, top projects)
        - Add commission profile system (standardized plan templates)
        - Add default profile assignment to user creation
        - Add seed data for common commission profiles
      </tasks>
    </step>

    <step number="7">
      <title>Post-MVP Workflows, Disputes, Adjustments</title>
      <tasks>
        - Add approvals statuses and roles (manager/finance)
        - Dispute tickets with comments
        - Adjustments module and approval gates
      </tasks>
    </step>

    <step number="8">
      <title>AI Commission Agent (Grounded)</title>
      <tasks>
        - Tool endpoints for fetching line items, plan rules, and audit history
        - Agent chat UI in right drawer
        - Draft dispute and draft adjustment flows
      </tasks>
    </step>

    <step number="9">
      <title>Hardening and Scale</title>
      <tasks>
        - Automated tests for calculator (golden fixtures)
        - Data integrity checks and idempotent sync/calc
        - Role-based UI guards
        - Postgres migration path and background job queue
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - Import/sync creates clean opportunity records (CSV and Excel)
      - Project tracking accurately captures PO, quote, job, and invoice data
      - PO remaining calculations are correct (total contract - total billed)
      - Margin calculations (hours, contract, extra) match spreadsheet logic
      - Calculator produces repeatable results from the same inputs (both opportunity and project-based)
      - Project-level commissions calculate correctly (seller milestones, profit owner at close)
      - Statements match saved calculation snapshots
      - Exports are correct and usable for payout processing
      - Audit trail shows who changed what and when
      - AR verification status properly gates commission payouts
    </functionality>

    <user_experience>
      - Reps can understand "what I'm getting paid and why" in under 60 seconds
      - Admin can update plans without breaking past statements
      - Sync and calc progress is transparent and fast
      - CFO/Management can view executive dashboard with aggregated project metrics
      - Project detail page provides comprehensive view matching spreadsheet functionality
      - Excel import reduces manual data entry for projects and jobs
    </user_experience>

    <technical_quality>
      - Calculator is unit-tested with fixtures
      - Schema supports plan versioning and immutability of past payouts
      - Schema supports both opportunity-based and project-based commissions
      - Database migrations handle schema evolution (ensureColumns for backward compatibility)
      - Secure secret handling and token encryption (when used)
      - Clear error handling and logs for ingest + calculations
      - Excel import handles multiple sheet types (projects, jobs, actuals)
    </technical_quality>
  </success_criteria>

  <implementation_status>
    <completed>
      - Foundation and data model (SQLite with sql.js, RBAC auth)
      - Frontend shell and navigation (React Router, Layout component)
      - CSV and Excel import (opportunities, projects, jobs, actuals)
      - Commission plan builder (flat_percent, tiered_percent, profit_percent, tiered_profit_percent, milestone_percent)
      - Commission calculator (opportunity-based and project-based)
      - Statements generation and export
      - Rep dashboard
      - Project tracking system (full CRUD, PO tracking, quote details, margins, invoices, AR)
      - Executive/CFO dashboard
      - Commission profiles with default assignment
      - User management with role-based access (rep/manager/finance/admin)
      - Settings management
      - Audit logging
      - Deal detail page with participants and job financials
    </completed>

    <in_progress>
      - Advanced margin calculations and reporting
      - Enhanced project dashboard matching spreadsheet layout
    </in_progress>

    <not_started>
      - AI Commission Agent (post-MVP)
      - Salesforce integration (structure exists, not fully implemented)
      - Workflows (rep review, manager approval, finance finalize)
      - Disputes system (schema exists, UI not implemented)
      - Adjustments approval workflows
      - Advanced plan features (product/category rates, region multipliers, quota accelerators)
      - Forecasting and analytics
      - Payroll export formats
      - Scheduled sync jobs
    </not_started>

    <test_coverage>
      - feature_list.json contains 262 test cases (exceeds initial 200 target)
      - Tests cover: security, authentication, CRUD operations, calculations, imports, dashboards
      - Both functional and style tests included
    </test_coverage>
  </implementation_status>
</project_specification>
